<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odyssey Vision One - The Forever Frame</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; color: #00ffcc; font-family: 'Rajdhani', sans-serif; }
        #container { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1; transition: opacity 0.5s; }
        
        /* World View (Starts Blurry) */
        #world-view { 
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop') no-repeat center center; 
            background-size: cover; 
            transition: filter 2.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            filter: blur(16px); 
            z-index: 0; 
            opacity: 0.8;
        }

        /* HUD Layer (POV Only) */
        #hud-overlay { 
            display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; 
            background: radial-gradient(circle, transparent 60%, rgba(0, 10, 5, 0.9) 100%);
            z-index: 20; pointer-events: none; /* Allow clicks to pass to children */
        }
        
        .hud-widget {
            position: absolute; background: rgba(0, 20, 10, 0.6); 
            border: 1px solid rgba(0, 255, 204, 0.3); border-radius: 8px;
            padding: 15px; backdrop-filter: blur(5px); pointer-events: auto;
            transition: all 0.3s;
        }
        .hud-widget h4 { color: #00FFCC; font-size: 0.8rem; margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 3px; }
        
        /* UI Controls (Inspect Mode) */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .header { position: absolute; top: 20px; left: 20px; border-left: 4px solid #00FFCC; padding-left: 15px; pointer-events: auto; }
        .header h1 { font-size: 2.5rem; font-weight: 700; color: #fff; text-transform: uppercase; line-height: 1; text-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .header p { color: #00FFCC; letter-spacing: 2px; font-size: 0.9rem; font-weight: 600; }

        .control-panel {
            position: absolute; top: 20px; right: 20px; width: 300px;
            background: rgba(10, 15, 20, 0.85); border: 1px solid #333;
            padding: 20px; border-radius: 4px; backdrop-filter: blur(10px);
            pointer-events: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .btn {
            background: rgba(0, 255, 204, 0.05); border: 1px solid #00FFCC; color: #00FFCC;
            padding: 12px; width: 100%; margin-bottom: 8px; cursor: pointer;
            font-weight: 700; transition: all 0.3s; text-transform: uppercase; font-size: 0.9rem;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:hover { background: #00FFCC; color: #000; box-shadow: 0 0 20px rgba(0, 255, 204, 0.4); }
        .btn.active { background: #00FFCC; color: #000; box-shadow: 0 0 10px #00FFCC; }
        .btn:disabled { border-color: #444; color: #666; background: transparent; cursor: not-allowed; box-shadow: none; }

        /* Exit Button (Red) */
        .exit-btn {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            background: rgba(40, 0, 0, 0.6); border: 1px solid #FF4444; color: #FF4444;
            padding: 12px 40px; font-weight: bold; letter-spacing: 3px; cursor: pointer;
            pointer-events: auto; transition: 0.3s; border-radius: 4px; font-size: 1rem;
            z-index: 50; text-transform: uppercase;
        }
        .exit-btn:hover { background: #FF4444; color: #000; box-shadow: 0 0 30px #FF4444; }

        /* Spec Card */
        #spec-card {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 320px; background: rgba(5, 10, 15, 0.95); 
            border: 1px solid #00FFCC; border-left: 4px solid #00FFCC;
            padding: 20px; display: none; pointer-events: none;
            box-shadow: 0 0 40px rgba(0, 255, 204, 0.2);
        }

        /* Scan Effect */
        .scan-line {
            position: absolute; top: 50%; left: 0; width: 100%; height: 2px;
            background: #00FFCC; opacity: 0; box-shadow: 0 0 10px #00FFCC; pointer-events: none;
        }
        @keyframes scanDown { 0% { top: 0%; opacity: 0.8; } 100% { top: 100%; opacity: 0; } }
        .scanning .scan-line { animation: scanDown 1.5s ease-in-out infinite; opacity: 1; }

        /* Retinal Scan Overlay */
        #retinal-overlay { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 600px; height: 600px; border-radius: 50%; 
            display: none; align-items: center; justify-content: center; 
            border: 2px solid rgba(0, 255, 204, 0.3); 
            z-index: 15; pointer-events: none; overflow: hidden;
        }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        .start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 100;
            transition: opacity 0.5s;
        }
        .start-btn {
            padding: 15px 50px; border: 2px solid #00FFCC; color: #00FFCC;
            font-size: 1.5rem; font-weight: bold; cursor: pointer; background: transparent;
            text-transform: uppercase; letter-spacing: 4px; transition: 0.3s;
        }
        .start-btn:hover { background: #00FFCC; color: #000; box-shadow: 0 0 40px #00FFCC; }

        .hud-grid {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 255, 204, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 204, 0.1) 1px, transparent 1px);
            background-size: 100px 100px; opacity: 0; transition: opacity 1s;
        }
    </style>
</head>
<body>
    <div id="world-view"></div>
    <div id="container"></div> <!-- 3D Layer -->

    <!-- Retinal Scan Overlay -->
    <div id="retinal-overlay">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Fundus_photograph_of_normal_left_eye_inside_view.jpg/600px-Fundus_photograph_of_normal_left_eye_inside_view.jpg" style="width: 100%; height: 100%; opacity: 0.6; mix-blend-mode: screen; filter: hue-rotate(120deg) contrast(1.2);">
        <div style="position: absolute; width: 100%; height: 2px; background: #00ffcc; animation: scan 2s infinite;"></div>
    </div>

    <!-- HUD Layer (POV) -->
    <div id="hud-overlay">
        <div id="hud-grid" class="hud-grid"></div>
        <div id="scan-beam" class="scan-line"></div>

        <!-- Widgets -->
        <div class="hud-widget" style="top: 30px; left: 30px; width: 280px;">
            <h4>OPTICAL ENGINE</h4>
            <div class="flex justify-between text-sm mb-2 text-gray-300"><span>TARGET:</span> <span>RETINA</span></div>
            <div class="flex justify-between text-sm mb-4 text-gray-300"><span>STATE:</span> <span id="focus-state" class="text-red-500 font-bold">UNCORRECTED</span></div>
            <button id="btn-focus" class="btn text-xs py-2" onclick="activateFocus()">INITIATE NEURAL FOCUS</button>
        </div>

        <div class="hud-widget" style="top: 30px; right: 30px; width: 220px; text-align: right;">
            <h4>SYSTEM VITALS</h4>
            <div class="text-2xl font-bold text-white">36.4Â°C</div>
            <div class="text-xs text-gray-400">TEMPLE TEMP (NOMINAL)</div>
            <div class="mt-2 text-xl font-bold text-green-400">98%</div>
            <div class="text-xs text-gray-400">AL-G CELL</div>
        </div>
        
        <div class="hud-widget" style="bottom: 30px; left: 30px; width: 280px;">
            <div class="flex items-center gap-2 mb-2 border-b border-gray-700 pb-2"><i data-lucide="activity" class="w-4 h-4"></i> <span class="font-bold">RETINAL DIAGNOSTICS</span></div>
            <div id="health-data" class="opacity-30 grayscale text-sm space-y-1 text-gray-300">
                <div class="flex justify-between"><span>VASCULAR:</span> <span>---</span></div>
                <div class="flex justify-between"><span>GLUCOSE:</span> <span>---</span></div>
                <div class="flex justify-between"><span>IOP:</span> <span>---</span></div>
            </div>
            <button id="btn-scan" class="btn mt-3" disabled onclick="runDiagnostics()">FEDNOW SCAN ($20.00)</button>
        </div>

        <div class="hud-widget" style="bottom: 30px; right: 30px; width: 250px; text-align: right;">
            <div class="text-xs text-gray-400 mb-1">ODYSSEY WALLET (FEDNOW)</div>
            <div class="text-2xl font-bold text-white">$<span id="wallet-balance">1,240.50</span></div>
            <div id="transaction-log" class="text-xs mt-2 text-gray-400 font-sans border-t border-gray-800 pt-2">Log: System Ready...</div>
        </div>

        <!-- Center Reticle -->
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.3;">
            <svg width="100" height="100" viewBox="0 0 100 100"><path d="M10,50 L90,50 M50,10 L50,90" stroke="#00FFCC" stroke-width="1"/><circle cx="50" cy="50" r="20" stroke="#00FFCC" stroke-width="1" fill="none"/></svg>
        </div>
        
        <!-- EXIT BUTTON -->
        <button class="exit-btn" onclick="setMode('inspect')">TAKE OFF GLASSES</button>
    </div>

    <!-- Inspection UI -->
    <div id="inspect-ui" class="ui-layer">
        <div class="header">
            <h1>Odyssey Vision</h1>
            <p>Bio-Optical Platform // Mk.I</p>
        </div>
        
        <div class="control-panel">
            <button id="btn-inspect" class="btn active" onclick="setMode('inspect')">Inspect Frame</button>
            <button id="btn-explode" class="btn" onclick="setMode('explode')">Detach Blades</button>
            <button id="btn-wear" class="btn" onclick="setMode('wear')">WEAR GLASSES (POV)</button>
            
            <div class="mt-4 pt-4 border-t border-gray-700 text-xs text-gray-400">
                <p class="mb-2">HOVER over components to view specs.</p>
                <p>CLICK "WEAR" to test Liquid Lens.</p>
            </div>
        </div>

        <div id="spec-card">
            <h3 id="card-title" class="text-xl font-bold text-white mb-1">COMPONENT</h3>
            <span id="card-tag" class="text-xs text-teal-400 font-bold tracking-widest mb-2 block">TECH SPEC</span>
            <p id="card-desc" class="text-sm text-gray-300 mb-3">Description...</p>
            <div class="grid grid-cols-2 gap-2 text-xs text-gray-500 border-t border-gray-700 pt-2">
                <div>MATERIAL: <span id="card-mat" class="text-white block">--</span></div>
                <div>LIFESPAN: <span id="card-life" class="text-white block">--</span></div>
            </div>
        </div>
    </div>

    <div id="start-overlay" class="start-overlay">
        <button class="start-btn" onclick="startSim()">INITIALIZE SYSTEM</button>
    </div>

    <script>
        lucide.createIcons();
        const STATE = { mode: 'inspect' };
        let scene, camera, renderer, glassesGroup, leftArm, rightArm, frameGroup;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let intersectedObj = null;

        function startSim() {
            document.getElementById('start-overlay').style.opacity = 0;
            setTimeout(() => document.getElementById('start-overlay').remove(), 500);
            init3D();
            animate();
        }

        function init3D() {
            const container = document.getElementById('container');
            scene = new THREE.Scene();
            scene.background = null; 

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 12);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.domElement.style.pointerEvents = 'auto'; 
            container.appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0x404040, 3); scene.add(ambient);
            const key = new THREE.DirectionalLight(0xFFFFFF, 2); key.position.set(5, 5, 10); scene.add(key);
            const rim = new THREE.SpotLight(0x00FFCC, 4); rim.position.set(-10, 0, 5); scene.add(rim);

            buildGlasses();
            window.addEventListener('resize', onResize);
            window.addEventListener('mousemove', onMouseMove);
        }

        function buildGlasses() {
            glassesGroup = new THREE.Group();
            scene.add(glassesGroup);

            const matFrame = new THREE.MeshPhysicalMaterial({ color: 0x111111, metalness: 1.0, roughness: 0.4, clearcoat: 1.0 });
            const matLens = new THREE.MeshPhysicalMaterial({ color: 0x00FFCC, metalness: 0.0, roughness: 0.0, transmission: 0.9, opacity: 0.3, transparent: true });
            const matBlade = new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.2, metalness: 0.8 });
            const matSensor = new THREE.MeshStandardMaterial({ color: 0xFFD700, emissive: 0x443300 });

            frameGroup = new THREE.Group();
            frameGroup.userData = { name: "THE FOREVER FRAME", tag: "MODULAR CHASSIS", desc: "Aeronautical Titanium skeleton. Designed to last a decade. Holds the Optic Block and Mag-Lock rails.", mat: "Grade 5 Titanium", life: "7+ Years" };
            
            const rimL = new THREE.Mesh(new THREE.TorusGeometry(2.2, 0.25, 32, 32), matFrame); rimL.position.x = -2.6;
            const rimR = new THREE.Mesh(new THREE.TorusGeometry(2.2, 0.25, 32, 32), matFrame); rimR.position.x = 2.6;
            const bridge = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 1.5, 16), matFrame); bridge.rotation.z = Math.PI/2;
            frameGroup.add(rimL, rimR, bridge);

            const lensL = new THREE.Mesh(new THREE.CircleGeometry(2.1, 32), matLens); lensL.position.x = -2.6;
            const lensR = new THREE.Mesh(new THREE.CircleGeometry(2.1, 32), matLens); lensR.position.x = 2.6;
            lensL.userData = lensR.userData = { name: "LIQUID CRYSTAL OPTIC", tag: "ADAPTIVE PRESCRIPTION", desc: "Tunable liquid crystal layer. Changes refractive index in 20ms.", mat: "Sapphire / LC Layer", life: "5 Years" };
            frameGroup.add(lensL, lensR);
            glassesGroup.add(frameGroup);

            const bladeGeo = new THREE.BoxGeometry(0.4, 0.8, 10);
            
            leftArm = new THREE.Group();
            const lb = new THREE.Mesh(bladeGeo, matBlade); lb.position.z = 5; leftArm.add(lb);
            for(let i=0;i<3;i++){
                const s = new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,0.1,16), matSensor);
                s.rotation.z=Math.PI/2; s.position.set(0.2, 0, 3+i*2); leftArm.add(s);
            }
            leftArm.position.set(-4.9, 0, -3);
            leftArm.userData = { name: "COMPUTE BLADE", tag: "SWAPPABLE ENGINE", desc: "Contains the Odyssey-1 AI Chip, Al-G Battery, and 6G Modem. Replace this part to upgrade.", mat: "Graphene Composite", life: "2 Years (Cycle)" };
            glassesGroup.add(leftArm);

            rightArm = leftArm.clone();
            rightArm.children[1].position.x = -0.2; rightArm.children[2].position.x = -0.2; rightArm.children[3].position.x = -0.2;
            rightArm.position.set(4.9, 0, -3);
            rightArm.userData = leftArm.userData;
            glassesGroup.add(rightArm);
        }

        window.setMode = (mode) => {
            STATE.mode = mode;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            
            if (mode === 'inspect') {
                document.getElementById('btn-inspect').classList.add('active');
                document.getElementById('hud-overlay').style.display = 'none';
                document.getElementById('inspect-ui').style.display = 'block';
                document.getElementById('container').style.opacity = 1; 
                
                new TWEEN.Tween(leftArm.position).to({x: -4.9, z: -3}, 800).easing(TWEEN.Easing.Back.Out).start();
                new TWEEN.Tween(rightArm.position).to({x: 4.9, z: -3}, 800).easing(TWEEN.Easing.Back.Out).start();
                new TWEEN.Tween(glassesGroup.rotation).to({y: 0}, 800).start();
                new TWEEN.Tween(camera.position).to({z: 12}, 1000).start();
            }
            else if (mode === 'explode') {
                document.getElementById('btn-explode').classList.add('active');
                document.getElementById('hud-overlay').style.display = 'none';
                document.getElementById('inspect-ui').style.display = 'block';
                document.getElementById('container').style.opacity = 1;
                
                new TWEEN.Tween(leftArm.position).to({x: -8, z: 2}, 800).easing(TWEEN.Easing.Cubic.Out).start();
                new TWEEN.Tween(rightArm.position).to({x: 8, z: 2}, 800).easing(TWEEN.Easing.Cubic.Out).start();
                new TWEEN.Tween(camera.position).to({z: 14}, 1000).start();
            }
            else if (mode === 'wear') {
                document.getElementById('btn-wear').classList.add('active');
                document.getElementById('inspect-ui').style.display = 'none';
                document.getElementById('hud-overlay').style.display = 'block';
                
                new TWEEN.Tween(camera.position).to({z: -2}, 1500).easing(TWEEN.Easing.Quadratic.In).onComplete(() => {
                    if(STATE.mode === 'wear') { 
                        document.getElementById('container').style.opacity = 0; 
                    }
                }).start();
                
                new TWEEN.Tween(leftArm.position).to({x: -4.9, z: -3}, 500).start();
                new TWEEN.Tween(rightArm.position).to({x: 4.9, z: -3}, 500).start();
            }
        };

        window.activateFocus = () => {
            const btn = document.getElementById('btn-focus');
            const state = document.getElementById('focus-state');
            const world = document.getElementById('world-view');
            const grid = document.getElementById('hud-grid');
            const beam = document.getElementById('scan-beam');

            btn.disabled = true; btn.innerText = "TUNING CRYSTALS...";
            grid.style.opacity = 0.3; document.body.classList.add('scanning');

            setTimeout(() => {
                document.getElementById('world-view').style.filter = "blur(0px)";
                document.getElementById('focus-state').innerText = "OPTIMIZED (20/10)";
                document.getElementById('focus-state').className = "text-green-400 font-bold";
                btn.innerText = "VISION CORRECTED";
                grid.style.opacity = 0.05; document.body.classList.remove('scanning');
                document.getElementById('btn-scan').disabled = false;
                document.getElementById('health-data').classList.remove('grayscale', 'opacity-30');
            }, 2000);
        };
        
        window.runDiagnostics = function() {
            const overlay = document.getElementById('retinal-overlay');
            const btn = document.getElementById('btn-scan');
            overlay.style.display = "flex"; 
            btn.innerText = "SCANNING...";
            
            setTimeout(() => {
                let bal = document.getElementById('wallet-balance');
                bal.innerText = (parseFloat(bal.innerText.replace(',','')) - 20.00).toLocaleString("en-US", {minimumFractionDigits: 2});
                document.getElementById('transaction-log').innerHTML = "<div class='text-green-400'>-$20.00 FEDNOW SENT</div>";
                overlay.style.display = "none";
                btn.innerText = "REPORT GENERATED";
                document.getElementById('health-data').innerHTML = `<div class="flex justify-between text-green-400"><span>VASCULAR:</span> <span>OK</span></div><div class="flex justify-between text-yellow-400"><span>GLUCOSE:</span> <span>115</span></div>`;
            }, 2000);
        };

        function onMouseMove(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            
            if(STATE.mode !== 'wear') {
                raycaster.setFromCamera(mouse, camera);
                let targets = [];
                if(frameGroup) targets.push(...frameGroup.children);
                if(leftArm) targets.push(...leftArm.children);
                if(rightArm) targets.push(...rightArm.children);

                const intersects = raycaster.intersectObjects(targets);
                const card = document.getElementById('spec-card');
                
                if (intersects.length > 0) {
                    let obj = intersects[0].object;
                    while(obj.parent && !obj.userData.name) obj = obj.parent;
                    if(obj.userData.name) {
                        card.style.display = 'block';
                        card.style.left = e.clientX + 20 + 'px';
                        card.style.top = e.clientY + 20 + 'px';
                        document.getElementById('card-title').innerText = obj.userData.name;
                        document.getElementById('card-tag').innerText = obj.userData.tag;
                        document.getElementById('card-desc').innerText = obj.userData.desc;
                        document.getElementById('card-mat').innerText = obj.userData.mat;
                        document.getElementById('card-life').innerText = obj.userData.life;
                    }
                } else { card.style.display = 'none'; }
                
                if(glassesGroup) { glassesGroup.rotation.y = mouse.x * 0.3; glassesGroup.rotation.x = mouse.y * 0.1; }
            }
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
